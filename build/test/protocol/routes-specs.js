"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
require("source-map-support/register");
var _lodash = require("lodash");
var _protocol = require("../../lib/protocol");
var _crypto = _interopRequireDefault(require("crypto"));
var _chai = _interopRequireDefault(require("chai"));
_chai.default.should();
describe('Protocol', function () {
  describe('ensure protocol consistency', function () {
    it('should not change protocol between patch versions', function () {
      let shasum = _crypto.default.createHash('sha1');
      for (let [url, urlMapping] of _lodash._.toPairs(_protocol.METHOD_MAP)) {
        shasum.update(url);
        for (let [method, methodMapping] of _lodash._.toPairs(urlMapping)) {
          shasum.update(method);
          if (methodMapping.command) {
            shasum.update(methodMapping.command);
          }
          if (methodMapping.payloadParams) {
            let allParams = _lodash._.flatten(methodMapping.payloadParams.required);
            if (methodMapping.payloadParams.optional) {
              allParams = allParams.concat(_lodash._.flatten(methodMapping.payloadParams.optional));
            }
            for (let param of allParams) {
              shasum.update(param);
            }
            if (methodMapping.payloadParams.wrap) {
              shasum.update('skip');
              shasum.update(methodMapping.payloadParams.wrap);
            }
          }
        }
      }
      let hash = shasum.digest('hex').substring(0, 8);
      hash.should.equal('5052d81b');
    });
  });
  describe('check route to command name conversion', function () {
    it('should properly lookup correct command name for endpoint with session', function () {
      const cmdName = (0, _protocol.routeToCommandName)('/timeouts', 'POST');
      cmdName.should.equal('timeouts');
    });
    it('should properly lookup correct command name for endpoint with session', function () {
      const cmdName = (0, _protocol.routeToCommandName)('/timeouts/implicit_wait', 'POST');
      cmdName.should.equal('implicitWait');
    });
    it('should properly lookup correct command name for endpoint without session', function () {
      const cmdName = (0, _protocol.routeToCommandName)('/status', 'GET');
      cmdName.should.equal('getStatus');
    });
    it('should properly lookup correct command name for endpoint without leading slash', function () {
      const cmdName = (0, _protocol.routeToCommandName)('status', 'GET');
      cmdName.should.equal('getStatus');
    });
    it('should properly lookup correct command name for fully specified endpoint', function () {
      const cmdName = (0, _protocol.routeToCommandName)('/wd/hub/status', 'GET');
      cmdName.should.equal('getStatus');
    });
    it('should not find command name if incorrect input data has been specified', function () {
      for (let [route, method] of [['/wd/hub/status', 'POST'], ['/xstatus', 'GET'], ['status', 'POST']]) {
        const cmdName = (0, _protocol.routeToCommandName)(route, method);
        _chai.default.should().equal(cmdName, undefined);
      }
    });
  });
});require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdC9wcm90b2NvbC9yb3V0ZXMtc3BlY3MuanMiLCJuYW1lcyI6WyJfbG9kYXNoIiwicmVxdWlyZSIsIl9wcm90b2NvbCIsIl9jcnlwdG8iLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwiX2NoYWkiLCJjaGFpIiwic2hvdWxkIiwiZGVzY3JpYmUiLCJpdCIsInNoYXN1bSIsImNyeXB0byIsImNyZWF0ZUhhc2giLCJ1cmwiLCJ1cmxNYXBwaW5nIiwiXyIsInRvUGFpcnMiLCJNRVRIT0RfTUFQIiwidXBkYXRlIiwibWV0aG9kIiwibWV0aG9kTWFwcGluZyIsImNvbW1hbmQiLCJwYXlsb2FkUGFyYW1zIiwiYWxsUGFyYW1zIiwiZmxhdHRlbiIsInJlcXVpcmVkIiwib3B0aW9uYWwiLCJjb25jYXQiLCJwYXJhbSIsIndyYXAiLCJoYXNoIiwiZGlnZXN0Iiwic3Vic3RyaW5nIiwiZXF1YWwiLCJjbWROYW1lIiwicm91dGVUb0NvbW1hbmROYW1lIiwicm91dGUiLCJ1bmRlZmluZWQiXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uIiwic291cmNlcyI6WyJ0ZXN0L3Byb3RvY29sL3JvdXRlcy1zcGVjcy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0cmFuc3BpbGU6bW9jaGFcblxuaW1wb3J0IHsgXyB9IGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBNRVRIT0RfTUFQLCByb3V0ZVRvQ29tbWFuZE5hbWUgfSBmcm9tICcuLi8uLi9saWIvcHJvdG9jb2wnO1xuaW1wb3J0IGNyeXB0byBmcm9tICdjcnlwdG8nO1xuaW1wb3J0IGNoYWkgZnJvbSAnY2hhaSc7XG5cblxuY2hhaS5zaG91bGQoKTtcblxuZGVzY3JpYmUoJ1Byb3RvY29sJywgZnVuY3Rpb24gKCkge1xuXG4gIC8vIFRPRE8gdGVzdCBhZ2FpbnN0IGFuIGV4cGxpY2l0IHByb3RvY29sIHJhdGhlciB0aGFuIGEgaGFzaCBvZiBhIHByZXZpb3VzXG4gIC8vIHByb3RvY29sXG5cbiAgZGVzY3JpYmUoJ2Vuc3VyZSBwcm90b2NvbCBjb25zaXN0ZW5jeScsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgnc2hvdWxkIG5vdCBjaGFuZ2UgcHJvdG9jb2wgYmV0d2VlbiBwYXRjaCB2ZXJzaW9ucycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBzaGFzdW0gPSBjcnlwdG8uY3JlYXRlSGFzaCgnc2hhMScpO1xuICAgICAgZm9yIChsZXQgW3VybCwgdXJsTWFwcGluZ10gb2YgXy50b1BhaXJzKE1FVEhPRF9NQVApKSB7XG4gICAgICAgIHNoYXN1bS51cGRhdGUodXJsKTtcbiAgICAgICAgZm9yIChsZXQgW21ldGhvZCwgbWV0aG9kTWFwcGluZ10gb2YgXy50b1BhaXJzKHVybE1hcHBpbmcpKSB7XG4gICAgICAgICAgc2hhc3VtLnVwZGF0ZShtZXRob2QpO1xuICAgICAgICAgIGlmIChtZXRob2RNYXBwaW5nLmNvbW1hbmQpIHtcbiAgICAgICAgICAgIHNoYXN1bS51cGRhdGUobWV0aG9kTWFwcGluZy5jb21tYW5kKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG1ldGhvZE1hcHBpbmcucGF5bG9hZFBhcmFtcykge1xuICAgICAgICAgICAgbGV0IGFsbFBhcmFtcyA9IF8uZmxhdHRlbihtZXRob2RNYXBwaW5nLnBheWxvYWRQYXJhbXMucmVxdWlyZWQpO1xuICAgICAgICAgICAgaWYgKG1ldGhvZE1hcHBpbmcucGF5bG9hZFBhcmFtcy5vcHRpb25hbCkge1xuICAgICAgICAgICAgICBhbGxQYXJhbXMgPSBhbGxQYXJhbXMuY29uY2F0KF8uZmxhdHRlbihtZXRob2RNYXBwaW5nLnBheWxvYWRQYXJhbXMub3B0aW9uYWwpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAobGV0IHBhcmFtIG9mIGFsbFBhcmFtcykge1xuICAgICAgICAgICAgICBzaGFzdW0udXBkYXRlKHBhcmFtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChtZXRob2RNYXBwaW5nLnBheWxvYWRQYXJhbXMud3JhcCkge1xuICAgICAgICAgICAgICBzaGFzdW0udXBkYXRlKCdza2lwJyk7XG4gICAgICAgICAgICAgIHNoYXN1bS51cGRhdGUobWV0aG9kTWFwcGluZy5wYXlsb2FkUGFyYW1zLndyYXApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgbGV0IGhhc2ggPSBzaGFzdW0uZGlnZXN0KCdoZXgnKS5zdWJzdHJpbmcoMCwgOCk7XG4gICAgICAvLyBNb2RpZnkgdGhlIGhhc2ggd2hlbmV2ZXIgdGhlIHByb3RvY29sIGhhcyBpbnRlbnRpb25hbGx5IGJlZW4gbW9kaWZpZWQuXG4gICAgICBoYXNoLnNob3VsZC5lcXVhbCgnNTA1MmQ4MWInKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NoZWNrIHJvdXRlIHRvIGNvbW1hbmQgbmFtZSBjb252ZXJzaW9uJywgZnVuY3Rpb24gKCkge1xuICAgIGl0KCdzaG91bGQgcHJvcGVybHkgbG9va3VwIGNvcnJlY3QgY29tbWFuZCBuYW1lIGZvciBlbmRwb2ludCB3aXRoIHNlc3Npb24nLCBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBjbWROYW1lID0gcm91dGVUb0NvbW1hbmROYW1lKCcvdGltZW91dHMnLCAnUE9TVCcpO1xuICAgICAgY21kTmFtZS5zaG91bGQuZXF1YWwoJ3RpbWVvdXRzJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHByb3Blcmx5IGxvb2t1cCBjb3JyZWN0IGNvbW1hbmQgbmFtZSBmb3IgZW5kcG9pbnQgd2l0aCBzZXNzaW9uJywgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgY21kTmFtZSA9IHJvdXRlVG9Db21tYW5kTmFtZSgnL3RpbWVvdXRzL2ltcGxpY2l0X3dhaXQnLCAnUE9TVCcpO1xuICAgICAgY21kTmFtZS5zaG91bGQuZXF1YWwoJ2ltcGxpY2l0V2FpdCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcm9wZXJseSBsb29rdXAgY29ycmVjdCBjb21tYW5kIG5hbWUgZm9yIGVuZHBvaW50IHdpdGhvdXQgc2Vzc2lvbicsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGNtZE5hbWUgPSByb3V0ZVRvQ29tbWFuZE5hbWUoJy9zdGF0dXMnLCAnR0VUJyk7XG4gICAgICBjbWROYW1lLnNob3VsZC5lcXVhbCgnZ2V0U3RhdHVzJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHByb3Blcmx5IGxvb2t1cCBjb3JyZWN0IGNvbW1hbmQgbmFtZSBmb3IgZW5kcG9pbnQgd2l0aG91dCBsZWFkaW5nIHNsYXNoJywgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgY21kTmFtZSA9IHJvdXRlVG9Db21tYW5kTmFtZSgnc3RhdHVzJywgJ0dFVCcpO1xuICAgICAgY21kTmFtZS5zaG91bGQuZXF1YWwoJ2dldFN0YXR1cycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcm9wZXJseSBsb29rdXAgY29ycmVjdCBjb21tYW5kIG5hbWUgZm9yIGZ1bGx5IHNwZWNpZmllZCBlbmRwb2ludCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGNtZE5hbWUgPSByb3V0ZVRvQ29tbWFuZE5hbWUoJy93ZC9odWIvc3RhdHVzJywgJ0dFVCcpO1xuICAgICAgY21kTmFtZS5zaG91bGQuZXF1YWwoJ2dldFN0YXR1cycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBub3QgZmluZCBjb21tYW5kIG5hbWUgaWYgaW5jb3JyZWN0IGlucHV0IGRhdGEgaGFzIGJlZW4gc3BlY2lmaWVkJywgZnVuY3Rpb24gKCkge1xuICAgICAgZm9yIChsZXQgW3JvdXRlLCBtZXRob2RdIG9mIFtbJy93ZC9odWIvc3RhdHVzJywgJ1BPU1QnXSwgWycveHN0YXR1cycsICdHRVQnXSwgWydzdGF0dXMnLCAnUE9TVCddXSkge1xuICAgICAgICBjb25zdCBjbWROYW1lID0gcm91dGVUb0NvbW1hbmROYW1lKHJvdXRlLCBtZXRob2QpO1xuICAgICAgICBjaGFpLnNob3VsZCgpLmVxdWFsKGNtZE5hbWUsIHVu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
